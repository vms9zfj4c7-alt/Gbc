<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Flappy NES Real</title>
    <style>
        /* --- 1. CONFIGURATION ÉCRAN --- */
        body {
            margin: 0; padding: 0;
            background-color: #000;
            height: 100vh; width: 100vw;
            overflow: hidden;
            display: flex; flex-direction: column;
            touch-action: none;
            user-select: none;
            -webkit-user-select: none;
        }

        /* --- 2. ZONE DE JEU (HAUT 50%) --- */
        #game-container {
            width: 100%;
            height: 50vh; /* Moitié haut */
            background: #000;
            display: flex; justify-content: center; align-items: flex-end;
            border-bottom: 2px solid #333;
            z-index: 1;
        }
        #game { width: 100% !important; height: 100% !important; }
        #game canvas {
            max-width: 100% !important;
            max-height: 100% !important;
            object-fit: contain !important;
        }

        /* --- 3. MANETTE RÉALISTE (BAS 50%) --- */
        #controller-area {
            position: relative;
            width: 100%;
            height: 50vh; /* Moitié bas */
            background-color: #1a1a1a;
            /* IMAGE DE LA MANETTE NES */
            background-image: url('https://upload.wikimedia.org/wikipedia/commons/8/83/Nintendo-Famicom-Controller-I-FL.jpg');
            background-size: 100% 100%; /* Étire l'image pour remplir le bas */
            background-position: center;
            background-repeat: no-repeat;
        }

        /* --- 4. ZONES TACTILES (BOUTONS INVISIBLES) --- */
        .touch-btn {
            position: absolute;
            z-index: 100;
            cursor: pointer;
            /* POUR LE TEST : Rouge transparent. METTRE opacity: 0 POUR RENDRE INVISIBLE */
            background-color: rgba(255, 0, 0, 0.3); 
            border: 1px solid yellow;
            border-radius: 10%;
        }

        /* POSITIONNEMENT PRÉCIS DES BOUTONS SUR L'IMAGE */
        /* Croix */
        #dpad-up { top: 18%; left: 16%; width: 10%; height: 12%; }
        #dpad-down { top: 42%; left: 16%; width: 10%; height: 12%; }
        #dpad-left { top: 30%; left: 6%; width: 10%; height: 12%; }
        #dpad-right { top: 30%; left: 26%; width: 10%; height: 12%; }
        
        /* Select / Start */
        #btn-select { top: 40%; left: 42%; width: 12%; height: 10%; }
        #btn-start { top: 40%; left: 56%; width: 12%; height: 10%; }

        /* A / B */
        #btn-b { top: 35%; left: 70%; width: 12%; height: 16%; border-radius: 50%; }
        #btn-a { top: 35%; left: 84%; width: 12%; height: 16%; border-radius: 50%; }

    </style>
</head>
<body>

    <div id="game-container">
        <div id="game"></div>
    </div>

    <div id="controller-area">
        <div id="dpad-up" class="touch-btn" data-key="38"></div>
        <div id="dpad-down" class="touch-btn" data-key="40"></div>
        <div id="dpad-left" class="touch-btn" data-key="37"></div>
        <div id="dpad-right" class="touch-btn" data-key="39"></div>
        
        <div id="btn-select" class="touch-btn" data-key="16"></div> <div id="btn-start" class="touch-btn" data-key="13"></div>  <div id="btn-b" class="touch-btn" data-key="90"></div>      <div id="btn-a" class="touch-btn" data-key="88"></div>      </div>

    <script>
        // --- 1. CONFIG EMULATEUR ---
        window.EJS_player = '#game';
        window.EJS_core = 'nes';
        window.EJS_gameUrl = 'flappy.nes';
        window.EJS_pathtodata = 'https://cdn.emulatorjs.org/latest/data/';
        window.EJS_startOnLoaded = true;
        // On cache les boutons par défaut de l'émulateur car on utilise les nôtres
        window.EJS_btns = false; 

        // --- 2. GESTION DU TACTILE ---
        // Cette fonction transforme nos touches tactiles en appui clavier pour l'émulateur
        function simulateKey(code, type) {
            const event = new KeyboardEvent(type, {
                bubbles: true, cancelable: true, keyCode: code, which: code
            });
            window.dispatchEvent(event);
        }

        // On attache les événements à tous les boutons rouges
        document.querySelectorAll('.touch-btn').forEach(btn => {
            const code = parseInt(btn.getAttribute('data-key'));
            
            // Quand on touche
            btn.addEventListener('touchstart', (e) => {
                e.preventDefault(); // Empêche le zoom/scroll
                simulateKey(code, 'keydown');
                btn.style.backgroundColor = "rgba(0, 255, 0, 0.5)"; // Devient vert quand touché
            }, {passive: false});

            // Quand on relâche
            btn.addEventListener('touchend', (e) => {
                e.preventDefault();
                simulateKey(code, 'keyup');
                btn.style.backgroundColor = "rgba(255, 0, 0, 0.3)"; // Redevient rouge
            }, {passive: false});
        });
    </script>

    <script src="https://cdn.emulatorjs.org/latest/data/loader.js"></script>

</body>
</html>
